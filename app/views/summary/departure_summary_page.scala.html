@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import controllers.movements.routes
@import forms.ConsignmentReferenceType
@import models.cache.DepartureAnswers
@import models.viewmodels.HtmlTableRow
@import views.Title
@import views.html.templates.main_template

@this(main_template: main_template)

@(data: DepartureAnswers)(implicit request: Request[_], messages: Messages)

  @main_template(title = Title("summary.departure.title")) {

    @components.back_link(routes.TransportController.displayPage())

    @components.page_title(Some(messages("summary.departure.title")))

    @components.summary_list(messages("summary.consignmentDetails")) {
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.referenceType"),
        value = data.consignmentReferences.map(ref =>
          if(ref.reference.equals(ConsignmentReferenceType.D)) {
            messages("consignmentReferences.reference.ducr")
          } else {
            messages("consignmentReferences.reference.mucr")
          }
        )
      ))
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.referenceValue"),
        value = data.consignmentReferences.map(_.referenceValue)
      ))
    }

    @components.summary_list(messages("location.title")) {
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.goodsLocation"),
        value = data.location.map(_.code)
      ))
    }

    @components.summary_list(messages("departureDetails.title")) {
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.departure.date"),
        value = data.departureDetails.map(_.dateOfDeparture.toString)
      ))
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.departure.time"),
        value = data.departureDetails.map(_.timeOfDeparture.toString)
      ))
    }

    @components.summary_list(messages("goodsDeparted.title")) {
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("goodsDeparted.header"),
        value = data.goodsDeparted.map(goodsDeparted => messages(s"goodsDeparted.departureLocation.${goodsDeparted.departureLocation.value}"))
      ))
    }

    @components.summary_list(messages("transport.title")) {
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.modeOfTransport"),
        value = data.transport.flatMap(_.modeOfTransport).map(modeOfTransport => messages(s"transport.modeOfTransport.$modeOfTransport"))
      ))
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.transportId"),
        value = data.transport.map(_.transportId)
      ))
      @components.table_row_no_change_link(HtmlTableRow(
        label = messages("summary.nationality"),
        value = data.transport.map(_.nationality)
      ))
    }

    @helper.form(action = routes.MovementSummaryController.submitMovementRequest()) {
        @helper.CSRF.formField

        @components.submit_button(messages("site.confirmAndSubmit"))
    }
  }