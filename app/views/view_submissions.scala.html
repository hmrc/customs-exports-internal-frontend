@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import java.time.format.DateTimeFormatter

@import models.notifications.NotificationFrontendModel
@import models.submissions.Submission
@import views.Title

@this(main_template: views.html.templates.main_template, formatter: DateTimeFormatter)

@(submissions: Seq[(Submission, Seq[NotificationFrontendModel])])(implicit request: Request[_], messages: Messages)


@main_template(title = Title("submissions.title"), fullWidth = true) {

  @components.back_link(routes.ChoiceController.displayPage())

  @components.page_title(Some(messages("submissions.title")))

  <div>
    <p>@messages("submissions.summary") </p>
    <table>
      <thead>
        <tr>
          <th scope="col" id="ucr">@messages("submissions.ucr")</th>
          <th scope="col" id="ucrType">@messages("submissions.submissionType")</th>
          <th scope="col" id="dateOfRequest">@messages("submissions.dateOfRequest")</th>
          <th scope="col" id="submissionAction">@messages("submissions.submissionAction")</th>
        </tr>
      </thead>
      <tbody>
      @for( (submission, notifications) <- submissions ){
        <tr>
          <td id="ucr-@submission.conversationId">
          @if(notifications.isEmpty) {
            @for(ucr <- submission.ucrBlocks.map(_.ucr)) { @ucr<br/> }
          } else {
            <a href="@routes.ViewNotificationsController.listOfNotifications(submission.conversationId)">
              @for(ucr <- submission.ucrBlocks.map(_.ucr)) { @ucr<br/> }
            </a>
          }

          </td>
          <td id="ucrType-@submission.conversationId">@for(ucr <- submission.ucrBlocks.map(_.ucrType + "UCR")) { @ucr<br/> }</td>
          <td id="dateOfRequest-@submission.conversationId">
              @formatter.format(submission.requestTimestamp)
          </td>
          <td id="submissionAction-@submission.conversationId">@messages(s"submissions.${submission.actionType.toString.toLowerCase}")</td>
        </tr>
      }
      </tbody>
    </table>
  </div class="govuk-grid-column-two-thirds">
}
